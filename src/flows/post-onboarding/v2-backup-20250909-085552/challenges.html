<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Challenges - Betterfly</title>
    
    <!-- üìù LEARNING NOTE: Applying Betterfly Design System -->
    <!-- Consolidated font loading strategy with font-display: swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/fonts/fonts.css">
    <!-- Using Obviously Narrow Bold for the logo from local assets -->
    
    <!-- Original CSS with correct design -->
    <link rel="stylesheet" href="styles/post-onboarding.css">
    <!-- Currency screen visibility fix -->
    <link rel="stylesheet" href="styles/currency-screen-fix.css">
    <!-- Scroll fixes -->
    <link rel="stylesheet" href="styles/scroll-fixes.css">
    <!-- Welcome screen fix -->
    <link rel="stylesheet" href="styles/welcome-fix.css">
    
    <!-- Debug mode toggle -->
    <script>
        // Add debug mode class to body for CSS debugging
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            document.addEventListener('DOMContentLoaded', function() {
                document.body.classList.add('debug-mode');
                console.log('üêõ Debug mode enabled');
            });
        }
    </script>
</head>
<body>
    <!-- üìù LEARNING NOTE: Challenges Page Screen - Pixel Perfect Figma Match -->
    <!-- Challenges page matching Figma design node-id=419-36539 exactly -->
    <div id="challenges-page" class="screen active">
        <!-- Main Container -->
        <div class="challenge-main-container">
            <!-- Profile Header with Status Bar -->
            <div class="profile-header">
                <!-- Status Bar - iOS Style -->
                <div class="status-bar">
                    <div class="time-section">
                        <div class="time">9:41</div>
                    </div>
                    <div class="levels-section">
                        <!-- Battery -->
                        <div class="battery-group">
                            <div class="battery-border"></div>
                            <div class="battery-cap"></div>
                            <div class="battery-capacity"></div>
                        </div>
                        <!-- WiFi -->
                        <div class="wifi-icon"></div>
                        <!-- Cellular -->
                        <div class="cellular-icon"></div>
                    </div>
                </div>

                <!-- Header Navigation -->
                <div class="header-nav">
                    <!-- User Avatar -->
                    <div class="avatar-section">
                        <div class="avatar">
                            <div class="user-initials-container"></div>
                            <div class="user-initials">AB</div>
                            <div class="status-ring"></div>
                        </div>
                    </div>
                    
                    <!-- Page Title -->
                    <div class="title-section">
                        <h1 class="title">Challenges</h1>
                    </div>
                    
                    <!-- Currency Counter -->
                    <div class="currency-counter" onclick="openCurrencyRewards()">
                        <div class="butterfly-icon"></div>
                        <div class="currency-amount">165</div>
                    </div>
                    
                    <!-- Menu Button -->
                    <div class="menu-button" onclick="goBack()">
                        <div class="menu-icon"></div>
                    </div>
                </div>
            </div>

        <!-- Main Content -->
        <div class="challenges-main-content">
            <!-- Challenges Header Section -->
            <div class="challenges-header-section">
                <h1 class="challenges-main-title">Your Challenges</h1>
                <p class="challenges-subtitle">Track progress, adjust settings, and stay on top of your goals.</p>
            </div>

            <!-- Active Challenge Card -->
            <div class="active-challenge-card">
                <div class="challenge-card-header">
                    <h2 class="challenge-card-title">Stand and Stretch</h2>
                </div>
                
                <!-- Progress Bar -->
                <div class="challenge-progress-section">
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 80%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Challenge Details -->
                <div class="challenge-details">
                    <div class="challenge-meta">
                        <span class="challenge-time">2 min</span>
                        <div class="challenge-reward">
                            <img src="./assets/betterflies-icon.svg" alt="100 butterflies" class="butterfly-svg-mini">
                            <span>+100</span>
                        </div>
                    </div>
                    <p class="challenge-description">Do a 2-minute stretch routine or stand up and move around.</p>
                    
                    <!-- Challenge Action Button -->
                    <div class="challenge-action-section">
                        <button class="challenge-action-button" onclick="startChallenge()">
                            <div class="button-icon play"></div>
                            <span id="challenge-btn-text">Start Challenge</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon-container streak">
                        <div class="stat-icon streak-icon"></div>
                    </div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-container butterflies">
                        <div class="stat-icon butterfly-icon"></div>
                    </div>
                    <div class="stat-value">165</div>
                    <div class="stat-label">Total BFs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-container completion">
                        <div class="stat-icon completion-icon"></div>
                    </div>
                    <div class="stat-value">85%</div>
                    <div class="stat-label">Week Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-container achievements">
                        <div class="stat-icon achievements-icon"></div>
                    </div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">Achievements</div>
                </div>
            </div>

            <!-- Monthly Challenge Section -->
            <div class="monthly-challenge-section">
                <div class="monthly-challenge-header">
                    <div class="monthly-challenge-subtitle">Monthly Challenge</div>
                    <h2 class="monthly-challenge-title">September Splash</h2>
                    <p class="monthly-challenge-description">Complete daily micro-habits to earn points and build lasting wellness routines.</p>
                </div>
                
                <!-- Weekly Challenge Groups -->
                <div class="weekly-challenge-groups">
                    <!-- Week 1 - Completed -->
                    <div class="week-group completed">
                        <div class="week-group-header">
                            <div class="week-info">
                                <h3 class="week-title">Week 1: Hydration Habit</h3>
                                <div class="status-chip completed">Complete (5/5 days)</div>
                            </div>
                            <div class="expand-icon down"></div>
                        </div>
                        <div class="week-progress">
                            <div class="progress-bar">
                                <div class="progress-fill completed" style="width: 100%"></div>
                            </div>
                            <span class="progress-percent">100%</span>
                        </div>
                    </div>
                    
                    <!-- Week 2 - Active and Expanded -->
                    <div class="week-group active expanded">
                        <div class="week-group-header">
                            <div class="week-info">
                                <h3 class="week-title">Week 2: Hydration Habit</h3>
                                <div class="status-chip active">Active (1/5 days)</div>
                            </div>
                            <div class="expand-icon up"></div>
                        </div>
                        <div class="week-progress">
                            <div class="progress-bar">
                                <div class="progress-fill active" style="width: 20%"></div>
                            </div>
                            <span class="progress-percent">20%</span>
                        </div>
                        
                        <!-- Daily Challenges List -->
                        <div class="daily-challenges-list">
                            <div class="challenge-item completed" onclick="viewChallengeDetails('Day 1')">
                                <div class="challenge-item-icon check"></div>
                                <div class="challenge-item-info">
                                    <div class="challenge-item-day">Day 1:</div>
                                    <div class="challenge-item-task">Drink 8 glasses of water</div>
                                </div>
                                <div class="challenge-item-menu"></div>
                            </div>
                            
                            <div class="challenge-item active" onclick="startDailyChallenge('Day 2')">
                                <div class="challenge-item-icon arrow"></div>
                                <div class="challenge-item-info">
                                    <div class="challenge-item-day">Day 2: <span class="today-badge">Today</span></div>
                                    <div class="challenge-item-task">Drink 8 glasses of water</div>
                                </div>
                                <div class="challenge-item-menu"></div>
                            </div>
                            
                            <div class="challenge-item pending" onclick="viewChallengeDetails('Day 3')">
                                <div class="challenge-item-icon clock"></div>
                                <div class="challenge-item-info">
                                    <div class="challenge-item-day">Day 3:</div>
                                    <div class="challenge-item-task">Drink 8 glasses of water</div>
                                </div>
                                <div class="challenge-item-menu"></div>
                            </div>
                            
                            <div class="challenge-item pending" onclick="viewChallengeDetails('Day 4')">
                                <div class="challenge-item-icon clock"></div>
                                <div class="challenge-item-info">
                                    <div class="challenge-item-day">Day 4:</div>
                                    <div class="challenge-item-task">Drink 8 glasses of water</div>
                                </div>
                                <div class="challenge-item-menu"></div>
                            </div>
                            
                            <div class="challenge-item pending" onclick="viewChallengeDetails('Day 5')">
                                <div class="challenge-item-icon clock"></div>
                                <div class="challenge-item-info">
                                    <div class="challenge-item-day">Day 5:</div>
                                    <div class="challenge-item-task">Drink 8 glasses of water</div>
                                </div>
                                <div class="challenge-item-menu"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Week 3 - Inactive -->
                    <div class="week-group inactive">
                        <div class="week-group-header">
                            <div class="week-info">
                                <h3 class="week-title">Week 3: Hydration Habit</h3>
                                <div class="status-chip inactive">Inactive (0/5 days)</div>
                            </div>
                            <div class="expand-icon down"></div>
                        </div>
                        <div class="week-progress">
                            <div class="progress-bar">
                                <div class="progress-fill inactive" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent">0%</span>
                        </div>
                    </div>
                    
                    <!-- Week 4 - Inactive -->
                    <div class="week-group inactive">
                        <div class="week-group-header">
                            <div class="week-info">
                                <h3 class="week-title">Week 4: Hydration Habit</h3>
                                <div class="status-chip inactive">Inactive (0/5 days)</div>
                            </div>
                            <div class="expand-icon down"></div>
                        </div>
                        <div class="week-progress">
                            <div class="progress-bar">
                                <div class="progress-fill inactive" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item">
                <div class="nav-icon home"></div>
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon benefits"></div>
                <span class="nav-label">Benefits</span>
            </div>
            <div class="nav-item active">
                <div class="nav-icon journey"></div>
                <span class="nav-label">Journey</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon social"></div>
                <span class="nav-label">Social</span>
            </div>
            <div class="nav-item">
                <img src="./assets/buddy.svg" alt="Buddy" class="nav-buddy-icon">
            </div>
        </div>
    </div>

    <!-- üõ°Ô∏è BULLETPROOF NAVIGATION SYSTEM -->
    <script src="scripts/bulletproof-navigation.js"></script>
    
    <!-- üìù LEARNING NOTE: Standalone Challenges Page JavaScript -->
    <!-- This page has its own JavaScript for navigation and interactions -->
    <script>
        // üéØ CHALLENGE STATE MANAGEMENT
        let challengeActive = false;
        let timeRemaining = 120;
        let challengeTimer = null;
        let butterflyCount = 165;

        // üìù LEARNING NOTE: Navigation Functions
        // These functions are now handled by the bulletproof navigation system
        // The bottom navigation will automatically work with the navigation script

        // üìù LEARNING NOTE: Challenge Functions
        // These functions handle the challenge interactions and state
        
        function startChallenge() {
            console.log('üöÄ Starting challenge...');
            
            if (challengeActive) {
                pauseChallenge();
            } else {
                challengeActive = true;
                updateChallengeDisplay();
                
                // Clear any existing timer
                if (challengeTimer) {
                    clearInterval(challengeTimer);
                }
                
                // Start new timer
                challengeTimer = setInterval(() => {
                    timeRemaining--;
                    updateChallengeDisplay();
                    
                    if (timeRemaining <= 0) {
                        completeChallenge();
                    }
                }, 1000);
                
                console.log('‚è±Ô∏è Challenge started');
            }
        }

        function pauseChallenge() {
            console.log('‚è∏Ô∏è Pausing challenge...');
            challengeActive = false;
            if (challengeTimer) {
                clearInterval(challengeTimer);
                challengeTimer = null;
            }
            updateChallengeDisplay();
        }

        function completeChallenge() {
            console.log('‚úÖ Challenge completed!');
            challengeActive = false;
            timeRemaining = 120;
            if (challengeTimer) {
                clearInterval(challengeTimer);
                challengeTimer = null;
            }
            
            // Navigate to claim screen
            window.location.href = 'claim-butterflies.html';
        }

        function updateChallengeDisplay() {
            const challengeBtnText = document.getElementById('challenge-btn-text');
            if (challengeBtnText) {
                if (challengeActive) {
                    challengeBtnText.textContent = `Pause ${formatTime(timeRemaining)}`;
                } else {
                    challengeBtnText.textContent = 'Start Challenge';
                }
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // üìù LEARNING NOTE: Daily Challenge Functions
        // These functions handle daily challenge interactions
        
        function startDailyChallenge(day) {
            console.log(`üöÄ Starting daily challenge: ${day}`);
            // For now, just show an alert - could be expanded to show modal or navigate
            alert(`Starting ${day} challenge! This would open the challenge timer.`);
        }

        function viewChallengeDetails(day) {
            console.log(`üëÅÔ∏è Viewing challenge details: ${day}`);
            // For now, just show an alert - could be expanded to show modal
            alert(`${day} challenge details would be shown here.`);
        }

        // üìù LEARNING NOTE: Page Initialization
        // This runs when the page loads to set up initial state
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Challenges page loaded successfully!');
            
            // Update currency display
            updateCurrencyDisplay();
            
            // Initialize challenge display
            updateChallengeDisplay();
        });

        function updateCurrencyDisplay() {
            const currencyElements = document.querySelectorAll('.currency-amount');
            currencyElements.forEach(element => {
                element.textContent = butterflyCount.toString();
            });
            console.log(`üí∞ Updated currency display: ${butterflyCount}`);
        }
    </script>
</body>
</html>
