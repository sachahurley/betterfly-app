<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betterfly - Review</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* iOS Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            background: #ffffff;
            height: 54px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.41px;
        }
        
        .status-time {
            color: #000000;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.41px;
        }
        
        .status-icons {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }
        
        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            height: 60px;
            background: #ffffff;
            position: sticky;
            top: 54px;
            z-index: 10;
            margin-top: 0;
        }
        
        .back-button {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #0f1c14;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 400;
            color: #0f1c14;
            text-align: center;
            flex: 1;
            line-height: 1.5;
        }
        
        .header-spacer {
            width: 40px;
        }
        
        /* Progress Bar */
        .progress-container {
            padding: 0 24px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            display: flex;
        }
        
        .progress-segment {
            flex: 1;
            height: 100%;
            margin-right: 2px;
        }
        
        .progress-segment:last-child {
            margin-right: 0;
        }
        
        .progress-segment.completed {
            background-color: #0167fe;
        }
        
        .progress-segment.incomplete {
            background-color: #dbdddc;
        }
        
        .progress-segment.final {
            background-color: var(--brand-green-50);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 24px 24px 32px 24px;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        /* Progress Indicator */
        .step-indicator {
            background: var(--brand-green-50);
            border: 1px solid var(--brand-green-50);
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.36px;
            display: inline-block;
            width: fit-content;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        /* Question Section */
        .question-section {
            margin-bottom: 24px;
        }
        
        .question-title {
            font-size: 20px;
            font-weight: 400;
            color: #000000;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .question-subtitle {
            font-size: 14px;
            font-weight: 400;
            color: #000000;
            line-height: 1.5;
        }
        
        /* Preferences Summary */
        .preferences-summary {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px 24px 0px 24px;
            margin-bottom: 12px;
            border: 1px solid #e5e5e5;
        }
        
        .preferences-title {
            font-size: 13px;
            font-weight: 600;
            color: #6f7772;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .preference-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .preference-item:last-child {
            border-bottom: none;
        }
        
        .preference-label {
            font-size: 15px;
            font-weight: 500;
            color: #333333;
        }
        
        .preference-value {
            font-size: 15px;
            font-weight: 400;
            color: #666666;
            text-align: right;
            max-width: 60%;
        }
        
        .info-note {
            font-size: 14px;
            color: #999999;
            line-height: 1.5;
            margin-bottom: 32px;
        }
        
        /* Button Section */
        .button-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: auto;
        }
        
        .button-primary {
            background-color: #0f1c14;
            height: 48px;
            border-radius: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
        }
        
        .button-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(15, 28, 20, 0.3);
        }
        
        .button-secondary {
            background-color: #ffffff;
            height: 48px;
            border-radius: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            border: 1px solid #0a0a0a;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            font-weight: 500;
            color: #0a0a0a;
        }
        
        .button-secondary:hover {
            background-color: rgba(10, 10, 10, 0.05);
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 24px 24px;
            }
            
            .question-title {
                font-size: 22px;
            }
            
            .question-subtitle {
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- iOS Status Bar -->
    <div class="status-bar">
        <div class="status-time">9:41</div>
        <div class="status-icons">
            <!-- Cellular Signal -->
            <div class="status-icon">
                <svg width="19" height="12" viewBox="0 0 19 12" fill="none">
                    <path d="M1 8.5h2v3h-2z" fill="currentColor"/>
                    <rect x="4.5" y="5" width="3" height="7" rx="0.5"/>
                    <rect x="9" y="3" width="3" height="9" rx="0.5"/>
                    <rect x="13.5" y="1" width="3" height="11" rx="0.5"/>
                </svg>
            </div>
            <!-- WiFi -->
            <div class="status-icon">
                <svg width="16" height="12" viewBox="0 0 16 12" fill="currentColor">
                    <path d="M8 11C8.55228 11 9 10.5523 9 10C9 9.44772 8.55228 9 8 9C7.44772 9 7 9.44772 7 10C7 10.5523 7.44772 11 8 11Z"/>
                    <path d="M5.12 7.12C6.248 5.992 8.008 5.992 9.136 7.12C9.392 7.376 9.808 7.376 10.064 7.12C10.32 6.864 10.32 6.448 10.064 6.192C8.424 4.552 5.744 4.552 4.104 6.192C3.848 6.448 3.848 6.864 4.104 7.12C4.36 7.376 4.776 7.376 5.032 7.12H5.12Z"/>
                    <path d="M2.928 4.928C5.28 2.576 9.152 2.576 11.504 4.928C11.76 5.184 12.176 5.184 12.432 4.928C12.688 4.672 12.688 4.256 12.432 4C9.568 1.136 4.864 1.136 2 4C1.744 4.256 1.744 4.672 2 4.928C2.256 5.184 2.672 5.184 2.928 4.928Z"/>
                    <path d="M0.736 2.736C4.016 -0.544 9.568 -0.544 12.848 2.736C13.104 2.992 13.52 2.992 13.776 2.736C14.032 2.48 14.032 2.064 13.776 1.808C9.984 -1.984 3.6 -1.984 -0.192 1.808C-0.448 2.064 -0.448 2.48 -0.192 2.736C0.064 2.992 0.48 2.992 0.736 2.736Z"/>
                </svg>
            </div>
            <!-- Battery -->
            <div class="status-icon">
                <svg width="25" height="12" viewBox="0 0 25 12" fill="none">
                    <rect x="0.5" y="0.5" width="21" height="11" rx="2.5" stroke="currentColor" fill="none" stroke-width="1" opacity="0.35"/>
                    <path d="M23 4V8" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" opacity="0.4"/>
                    <rect x="2" y="2" width="18" height="8" rx="1.5" fill="currentColor"/>
                </svg>
            </div>
        </div>
    </div>
    
    <!-- Header -->
    <div class="header">
        <button class="back-button" onclick="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="#0f1c14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <div class="header-title">Review</div>
        <div class="header-spacer"></div>
    </div>
    
            <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-segment final"></div>
                <div class="progress-segment final"></div>
                <div class="progress-segment final"></div>
                <div class="progress-segment final"></div>
                <div class="progress-segment final"></div>
                <div class="progress-segment final"></div>
            </div>
        </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Step Indicator -->
        <div class="step-indicator">Step 6 of 6</div>
        
        <!-- Question Section -->
        <div class="question-section">
            <h1 class="question-title">Let's Review Your Progress</h1>
            <p class="question-subtitle">Here's what you've shared with us and what you can look forward to.</p>
        </div>
        
        <!-- Preferences Summary -->
        <div class="preferences-summary">
            <div class="preferences-title">Your selections</div>
            <div class="preference-item">
                <div class="preference-label">Primary Goal</div>
                <div class="preference-value" id="primaryGoal">Boost Productivity</div>
            </div>
            <div class="preference-item">
                <div class="preference-label">Biggest Blocker</div>
                <div class="preference-value" id="biggestBlocker">Energy</div>
            </div>
            <div class="preference-item">
                <div class="preference-label">Top Interests</div>
                <div class="preference-value" id="topInterests">Fitness & Health, Mental Wellness</div>
            </div>
            <div class="preference-item">
                <div class="preference-label">Daily Time</div>
                <div class="preference-value" id="dailyTime">5 min/day</div>
            </div>
            <div class="preference-item">
                <div class="preference-label">Preferred Support</div>
                <div class="preference-value" id="preferredSupport">Accountability</div>
            </div>
        </div>
        
        <div class="info-note">You can update these preferences anytime in your settings.</div>
        
        <!-- Button Section -->
        <div class="button-section">
            <button class="button-primary" onclick="handleDone()">Done</button>
            <button class="button-secondary" onclick="handleEditAnswers()">Edit My Answers</button>
        </div>
    </div>

    <script src="../../../../shared/user-state.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Load user preferences from localStorage
        function loadUserPreferences() {
            // 🔴 FIXED: Use UserState.getPreferences() for consistent data access
            const preferences = UserState.getPreferences();
            
            // Format time display
            let timeDisplay = preferences.dailyTime || 'Not specified';
            if (timeDisplay === '2-min') timeDisplay = '2 min/day';
            if (timeDisplay === '5-min') timeDisplay = '5 min/day';
            if (timeDisplay === '10-min') timeDisplay = '10+ min/day';
            
            // Update the display with user's actual choices
            document.getElementById('primaryGoal').textContent = preferences.primaryGoal || 'Not specified';
            document.getElementById('biggestBlocker').textContent = preferences.biggestBlocker || 'Not specified';
            document.getElementById('topInterests').textContent = preferences.topInterests || 'Not specified';
            document.getElementById('dailyTime').textContent = timeDisplay;
            document.getElementById('preferredSupport').textContent = preferences.preferredSupport || 'Not specified';
        }
        
        function goBack() {
            window.location.href = 'questionnaire-5.html';
        }
        
        function handleDone() {
            // 🔴 FIXED: Use UserState.getPreferences() for consistent data access
            const preferences = UserState.getPreferences();
            
            // Save all preferences to persistent state
            UserState.saveOnboarding({
                primaryGoal: preferences.primaryGoal,
                biggestBlocker: preferences.biggestBlocker,
                topInterests: preferences.topInterests,
                dailyTime: preferences.dailyTime,
                supportType: preferences.preferredSupport
            });
            
            // Save completion status
            localStorage.setItem('onboardingCompleted', 'true');
            // Navigate to completion page
            window.location.href = 'completion.html';
        }
        
        function handleEditAnswers() {
            // Navigate back to first questionnaire page
            window.location.href = 'questionnaire.html';
        }
        
        // Load preferences when page loads
        document.addEventListener('DOMContentLoaded', loadUserPreferences);
    </script>
</body>
</html>
